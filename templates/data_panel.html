<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数据面板</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bulma.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/jquery.dataTables.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/data-table.css') }}">
    <script src="{{ url_for('static', filename='js/jquery-3.6.0.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.dataTables.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.contextMenu.min.js') }}"></script>
    <link href="{{ url_for('static', filename='css/css2.css') }}" rel="stylesheet">

    <style>
        body {
            background-color: #1e1e1e; /* 深色背景 */
            font-family: 'KaiTi', serif; /* 使用楷体 */
            margin: 0;
            padding: 0;
        }

        .navbar {
            background-color: #2e2e2e; /* 深色导航栏 */
            padding: 15px 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .navbar-menu {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar-item {
            margin: 0 10px;
            color: red; /* 将字体颜色改为红色 */
            text-decoration: none;
        }

        .navbar-item:hover {
            color: lightcoral; /* 鼠标悬停时的颜色 */
        }

        .search-container {
            margin: 20px auto;
            display: flex;
            justify-content: center;
        }

        .search-input {
            width: 600px; /* 自定义搜索框的宽度 */
            height: 40px; /* 自定义搜索框的高度 */
            padding: 10px;
            border-radius: 4px 0 0 4px; /* 圆角左侧 */
            border: 1px solid #ccc;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .search-button {
            height: 40px; /* 与搜索框高度一致 */
            padding: 0 15px; /* 左右内边距 */
            border: none;
            border-radius: 0 4px 4px 0; /* 圆角右侧 */
            background-color: #28a745; /* 按钮背景色 */
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .search-button:hover {
            background-color: #218838; /* 悬停时的背景色 */
        }

        .card-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center; /* 居中对齐卡片 */
            padding: 20px;
            margin: 20px; /* 添加外围间距 */
            border: 2px solid #191229; /* 金色外框 */
            border-radius: 12px; /* 圆角边框 */
            background: #2a2a2a; /* 深色背景 */
        }

        .card {
            flex: 1 1 calc(16.66% - 1rem); /* 每行6个卡片 */
            background-color: #2c2c2c; /* 墨色背景 */
            color: #e0e0e0;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s, box-shadow 0.3s; /* 动态效果 */
            font-size: 0.85rem; /* 缩小字体 */
            padding: 10px; /* 增加内边距 */
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.5);
        }

        .card-header {
            background-color: #28a745; /* IP区域背景色 */
            color: #fff;
            padding: 10px; /* 缩小内边距 */
            border-radius: 8px; /* 圆角边框 */
            font-size: 1rem; /* IP字体大小 */
            text-align: center; /* 标题居中 */
            margin-bottom: 10px;
            display: flex; /* 使用 flexbox */
            align-items: center; /* 垂直居中 */
            justify-content: center; /* 水平居中 */
        }

        .detail {
            margin-bottom: 6px; /* 缩小边距 */
        }

        .detail strong {
            color: #4CAF50; /* 强调文字颜色 */
        }

        .web-title {
            font-size: 0.8rem; /* 缩小文字大小 */
            color: #FF4500; /* 更亮的颜色 */
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7); /* 添加更明显的文字阴影 */
            background-color: rgba(255, 255, 255, 0.1); /* 添加轻微背景 */
            padding: 2px; /* 添加内边距 */
            border-radius: 4px; /* 圆角 */
        }

        .host-link {
            color: #007bff; /* 蓝色 */
            text-decoration: none; /* 去掉下划线 */
        }

        .host-link:hover {
            text-decoration: underline; /* 悬停时添加下划线 */
        }

        /* 交替颜色 */
        .card:nth-child(2n) .card-header {
            background-color: #218838; /* 交替背景色 */
        }
    </style>
</head>

<body>
    <nav class="navbar">
        <div class="navbar-menu">
            <div class="navbar-start">
                <a class="navbar-item" href="/fofa_search">FOFA</a>
                <a class="navbar-item" href="/quake_search">Quake</a>
                <a class="navbar-item" href="/data_aggregation">数据聚合</a>
                <a class="navbar-item" href="/data_panel">精简面板</a>
                <a class="navbar-item" href="/about">关于我们</a>
            </div>
            <div class="navbar-end">
                <button id="clearDatabaseBtn" class="button is-danger">清空数据库</button>
            </div>
        </div>
    </nav>

    <div class="search-container">
        <input type="text" id="searchInput" class="search-input" placeholder="搜索..." />
        <button class="search-button">搜索</button>
    </div>

    <div class="card-container" id="cardContainer">
        {% for result in results %}
        <div class="card">
            <div class="card-header">
                {{ result.ip }}
            </div>
            <div class="card-body">
                {% for detail in result.details %}
                <div class="detail">
                    <strong>端口:</strong> {{ detail.port }}
                </div>
                <div class="web-title">
                    <strong>网页标题:</strong> {{ detail.titles | join(", ") }}
                </div>
                <div class="detail">
                    <strong>协议:</strong> {{ detail.protocols | join(", ") }}
                </div>
                <div class="detail">
                    <strong>域名:</strong> {{ detail.domains | join(", ") }}
                </div>
                <div class="detail">
                    <strong>Host:</strong>
                    {% if detail.hosts and detail.hosts | length > 0 %}
                        <a href="{{ detail.hosts[0] }}" class="host-link" target="_blank">{{ detail.hosts[0] }}</a>
                    {% else %}
                        N/A
                    {% endif %}
                </div>
                <div class="detail">
                    <strong>指纹信息:</strong> {{ detail.components | join(", ") }}
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>

    <script>
        $(document).ready(function () {
            // 搜索功能
            $('#searchInput').on('keyup', function () {
                const value = $(this).val().toLowerCase();
                $('#cardContainer .card').filter(function () {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
                });
            });

            $('#clearDatabaseBtn').on('click', function() {
                if (confirm("您确定要清空数据面板历史记录吗？此操作无法撤销！")) {
                    $.ajax({
                        url: '/clear_data_panel_history',
                        type: 'POST',
                        success: function(response) {
                            alert(response.message);
                            location.reload();
                        },
                        error: function(xhr) {
                            alert("清空数据面板历史记录时发生错误: " + xhr.responseJSON.error);
                        }
                    });
                }
            });

            // 搜索按钮功能
            $('.search-button').on('click', function() {
                const value = $('#searchInput').val().toLowerCase();
                $('#cardContainer .card').filter(function() {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
                });
            });
        });
    </script>
</body>

</html>
